@startuml
title RootPriceOracle 시퀀스 다이어그램

actor User
participant "RootPriceOracle" as RPO
participant "SpotOracle" as SO
participant "PythOracle" as PO

note over User, RPO
  상황: 오라클 초기화 시
  목적: 관리자 권한 설정
end note

User -> RPO: initialize(initialAdmin)
activate RPO
RPO -> RPO: _grantRole(DEFAULT_ADMIN_ROLE, initialAdmin)
note right: 초기 관리자 권한 부여
deactivate RPO

note over User, RPO
  상황: 스팟 오라클 설정 시
  목적: 스팟 가격 오라클 설정
end note

User -> RPO: setSpotOracle(spotOracle_)
activate RPO
RPO -> RPO: 권한 확인
note right: MANAGER_ROLE 권한 확인
RPO -> RPO: spotOracle 설정
note right: 스팟 오라클 주소 저장
deactivate RPO

note over User, RPO
  상황: Pyth 오라클 설정 시
  목적: Pyth 가격 오라클 설정
end note

User -> RPO: setPythOracle(pythOracle_)
activate RPO
RPO -> RPO: 권한 확인
note right: MANAGER_ROLE 권한 확인
RPO -> RPO: pythOracle 설정
note right: Pyth 오라클 주소 저장
deactivate RPO

note over User, RPO
  상황: 자산 가격 조회 시
  목적: 스팟과 Pyth 오라클의 가격 비교
end note

User -> RPO: getPrice(asset)
activate RPO
RPO -> RPO: _getAssetAvailability(asset)
note right: 오라클 가용성 확인
RPO -> PO: getPrice(asset)
activate PO
PO --> RPO: pythData
deactivate PO
RPO -> SO: getPrice(asset)
activate SO
SO --> RPO: spotData
deactivate SO
RPO -> RPO: _selectLargestDeviation(pythData, spotData)
note right: 가장 큰 가격 편차 선택
RPO --> User: selectedData
deactivate RPO

@enduml 
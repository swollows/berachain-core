@startuml
title StakingRewards 시퀀스 다이어그램

actor User
participant "StakingRewards" as SR
participant "StakeToken" as ST
participant "RewardToken" as RT

note over User, SR
  상황: 스테이킹 컨트랙트 초기화 시
  목적: 스테이킹 및 보상 토큰 설정
end note

User -> SR: __StakingRewards_init(stakingToken, rewardToken, rewardsDuration)
activate SR
SR -> SR: 설정 저장
note right: 토큰 주소 및 보상 기간 설정
deactivate SR

note over User, SR
  상황: 새로운 보상이 추가될 때
  목적: 보상 금액 업데이트 및 분배
end note

User -> SR: _notifyRewardAmount(reward)
activate SR
SR -> SR: _checkRewardSolvency()
note right: 보상 토큰 잔액 확인
SR -> SR: _setRewardRate()
note right: 보상 비율 설정
SR -> SR: _updateReward(address(0))
note right: 전체 보상 업데이트
deactivate SR

note over User, SR
  상황: 사용자가 토큰을 스테이킹할 때
  목적: 스테이킹 처리 및 보상 계산
end note

User -> SR: _stake(account, amount)
activate SR
SR -> SR: _updateReward(account)
note right: 계정 보상 업데이트
SR -> ST: safeTransferFrom(user, amount)
activate ST
ST --> SR: transfer success
deactivate ST
SR -> SR: balance 업데이트
note right: 스테이킹 잔액 증가
deactivate SR

note over User, SR
  상황: 사용자가 보상을 청구할 때
  목적: 보상 지급 및 업데이트
end note

User -> SR: _getReward(account, recipient)
activate SR
SR -> SR: _updateReward(account)
note right: 계정 보상 업데이트
SR -> RT: safeTransfer(recipient, reward)
activate RT
RT --> SR: transfer success
deactivate RT
deactivate SR

note over User, SR
  상황: 사용자가 스테이킹을 해제할 때
  목적: 스테이킹 해제 및 보상 계산
end note

User -> SR: _withdraw(account, amount)
activate SR
SR -> SR: _updateReward(account)
note right: 계정 보상 업데이트
SR -> ST: safeTransfer(user, amount)
activate ST
ST --> SR: transfer success
deactivate ST
SR -> SR: balance 업데이트
note right: 스테이킹 잔액 감소
deactivate SR

@enduml 
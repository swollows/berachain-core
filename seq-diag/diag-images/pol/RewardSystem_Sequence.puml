@startuml
title 보상 시스템 시퀀스 다이어그램

actor Validator
participant "BeaconDeposit" as BD
participant "BeraChef" as BC
participant "BlockRewardController" as BRC
participant "Distributor" as D
participant "RewardVault" as RV
participant "BGT" as BGT

note over Validator, BD
  상황: 밸리데이터가 새로운 예치금을 입금할 때
  목적: 밸리데이터 등록 및 운영자 설정
end note

Validator -> BD: deposit(pubkey, credentials, signature, operator)
activate BD
BD -> BD: _validateDeposit()
note right: 예치금 금액, 공개키, 자격증명, 서명 검증
BD -> BD: _processDeposit()
note right: 예치금 처리 및 이벤트 발생
BD -> BC: onDeposit(validator, amount)
activate BC
BC -> BC: _updateValidatorRewards(validator)
note right: 밸리데이터의 보상 할당 업데이트
deactivate BC
deactivate BD

note over D, BRC
  상황: 새로운 블록이 생성될 때마다
  목적: 밸리데이터에게 보상 지급
end note

D -> BRC: processRewards(pubkey, nextTimestamp, isReady)
activate BRC
BRC -> BGT: mint(operator, base)
note right: 기본 보상 지급
BRC -> BGT: mint(distributor, reward)
note right: 추가 보상 지급
deactivate BRC

note over D, BC
  상황: 보상 분배 시
  목적: 밸리데이터의 활성 보상 할당 확인
end note

D -> BC: getActiveRewardAllocation(pubkey)
activate BC
BC -> BC: _getActiveRewardAllocation()
note right: 밸리데이터의 현재 보상 할당 조회
deactivate BC

note over D, RV
  상황: 보상 분배 시
  목적: 보상 볼트에 보상 금액 알림
end note

D -> RV: notifyRewardAmount(pubkey, rewardAmount)
activate RV
RV -> RV: _notifyRewardAmount()
note right: 보상 볼트의 보상 금액 업데이트
deactivate RV

@enduml 